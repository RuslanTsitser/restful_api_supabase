# Tasks API

This module provides a RESTful API for managing tasks using Supabase Edge Functions. It includes full CRUD operations for tasks with user authentication.

## Features

- Create, Read, Update, and Delete tasks
- User-specific task management
- JWT authentication
- CORS support
- Error handling

## API Endpoints

### Get All Tasks
- **Endpoint**: `/tasks`
- **Method**: GET
- **Headers**: 
  ```
  Authorization: Bearer <jwt_token>
  ```
- **Response**:
  ```json
  {
    "tasks": [
      {
        "id": 1,
        "title": "Task title",
        "is_completed": false,
        "email": "user@example.com"
      }
    ]
  }
  ```

### Get Single Task
- **Endpoint**: `/tasks/{id}`
- **Method**: GET
- **Headers**: 
  ```
  Authorization: Bearer <jwt_token>
  ```
- **Response**:
  ```json
  {
    "task": {
      "id": 1,
      "title": "Task title",
      "is_completed": false,
      "email": "user@example.com"
    }
  }
  ```

### Create Task
- **Endpoint**: `/tasks`
- **Method**: POST
- **Headers**: 
  ```
  Authorization: Bearer <jwt_token>
  ```
- **Body**:
  ```json
  {
    "title": "New task title"
  }
  ```
- **Response**:
  ```json
  {
    "status": "Created"
  }
  ```

### Update Task
- **Endpoint**: `/tasks/{id}`
- **Method**: PUT
- **Headers**: 
  ```
  Authorization: Bearer <jwt_token>
  ```
- **Body**:
  ```json
  {
    "title": "Updated task title",
    "is_completed": true
  }
  ```
- **Response**:
  ```json
  {
    "status": "Updated"
  }
  ```

### Delete Task
- **Endpoint**: `/tasks/{id}`
- **Method**: DELETE
- **Headers**: 
  ```
  Authorization: Bearer <jwt_token>
  ```
- **Response**:
  ```json
  {}
  ```

## Database Schema

The tasks are stored in a Supabase table with the following structure:

```sql
create table tasks (
  id bigint generated by default as identity primary key,
  title text not null,
  is_completed boolean default false,
  email text not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);
```

## Authentication

All endpoints require JWT authentication. The token should be included in the Authorization header as a Bearer token. The token must contain a valid email claim.

## Error Handling

The API includes error handling for:
- Missing authentication token
- Invalid authentication token
- Invalid task ID
- Database errors
- Invalid request body

## CORS Support

The API includes CORS headers to allow cross-origin requests:
- Access-Control-Allow-Origin: *
- Access-Control-Allow-Headers: authorization, x-client-info, apikey
- Access-Control-Allow-Methods: POST, GET, OPTIONS, PUT, DELETE 